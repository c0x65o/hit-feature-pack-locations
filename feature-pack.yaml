# Feature Pack: locations
# Locations management with hierarchical structure, user assignments, maps, and geocoding

name: locations
version: 1.0.0
description: Locations feature pack with hierarchical locations, user assignments, map visualization, and geocoding

# Route definitions - mapped to React components
routes:
  - path: /locations
    page: Dashboard
    roles: []  # Empty = authenticated users only
  - path: /locations/list
    page: LocationList
    roles: []
  - path: /locations/new
    page: LocationEdit
    roles: []
  - path: /locations/[id]
    page: LocationDetail
    roles: []
  - path: /locations/[id]/edit
    page: LocationEdit
    roles: []
  - path: /locations/types
    page: LocationTypes
    roles: []

# Navigation contributions - auto-added to shell sidebar
nav:
  - id: locations
    label: Locations
    path: /locations
    icon: MapPin
    group: main  # Primary business features
    showWhen: authenticated
    weight: 150  # Primary content near top (lower weight = higher position)
    children:
      - id: locations-dashboard
        label: Dashboard
        path: /locations
        icon: LayoutDashboard
        weight: 100
        showWhen: authenticated
      - id: locations-list
        label: All Locations
        path: /locations/list
        icon: MapPin
        weight: 110
        showWhen: authenticated
      - id: locations-types
        label: Location Types
        path: /locations/types
        icon: Tag
        weight: 120
        showWhen: authenticated

# Schema contributions (Drizzle tables)
# Projects import these into their schema
schema:
  source: src/schema/locations.ts
  exports: [locationTypes, locations, locationUserMemberships, LocationType, InsertLocationType, UpdateLocationType, Location, InsertLocation, UpdateLocation, LocationUserMembership, InsertLocationUserMembership, UpdateLocationUserMembership, DEFAULT_LOCATION_TYPES]

# API routes the feature pack expects
# Projects create these routes using the schema
api:
  routes:
    - path: /api/locations
      methods: [GET, POST]
      description: "List locations (GET) or create location (POST)"
    - path: /api/locations/[id]
      methods: [GET, PUT, DELETE]
      description: "Get, update, or delete a specific location"
    - path: /api/locations/tree
      methods: [GET]
      description: "Get locations in hierarchical tree structure"
    - path: /api/locations/types
      methods: [GET, POST]
      description: "List location types (GET) or create type (POST)"
    - path: /api/locations/types/[id]
      methods: [GET, PUT, DELETE]
      description: "Get, update, or delete a specific location type"
    - path: /api/locations/memberships
      methods: [GET, POST]
      description: "Get location memberships (GET) or assign user to location (POST). GET supports ?locationId=xxx filter"
    - path: /api/locations/memberships/[id]
      methods: [DELETE]
      description: "Remove user from location"
    - path: /api/locations/[id]/memberships
      methods: [GET]
      description: "Get all users assigned to a specific location"
    - path: /api/locations/geocode
      methods: [POST]
      description: "Geocode address to latitude/longitude"

# No module dependencies - runs on project's own database
requires:
  modules: []

# Dependencies on other feature packs
dependencies:
  feature_packs:
    - name: dashboard-shell

# Configurable options
config:
  schema:
    hierarchical_enabled:
      type: boolean
      default: true
      description: "Enable hierarchical parent/child location relationships"
    map_enabled:
      type: boolean
      default: true
      description: "Enable map visualization for locations"
    geocoding_enabled:
      type: boolean
      default: true
      description: "Enable automatic geocoding of addresses to coordinates"
    geocoding_provider:
      type: string
      default: "nominatim"
      enum: [nominatim, google]
      description: "Geocoding provider (nominatim is free, google requires API key)"
    require_location_on_signup:
      type: boolean
      default: false
      description: "Require location selection during user signup"
    default_new_user_strategy:
      type: string
      default: "primary"
      enum: [primary, first_location, none]
      description: "Strategy for assigning default location to new users (primary=HQ location, first_location=first active location, none=no auto-assignment)"
    allow_multiple_user_locations:
      type: boolean
      default: true
      description: "Allow users to be assigned to multiple locations"
